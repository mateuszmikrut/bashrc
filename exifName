#!/bin/bash

function changeName(){
	# Ignoruj spacje w argumencie	
	SAVEIFS=$IFS
	IFS=$(echo -en "\n\b")	
	
	#Sprawdź czy plik jest obrazem
	if file $1 | grep image > /dev/null ; then
		#Pobierz date, gdzodzine z exifa
		fulldate=`identify -verbose $1 | grep DateTimeOriginal`
		data=`echo $fulldate | awk '{print $2}' | tr ':' '-'` 
		godzina=`echo $fulldate | awk '{print $3}' | tr ':' '.'`
		roz=`echo ${1##*.} | tr A-Z a-z`
		if [[ ! $data ]] || [[ ! $godzina ]] || [[ ! $roz ]]; then
			echo "Probably specified file ($1) has no EXIF data available. Exiting ..."
		else
			if [ $save == 0 ]; then
				mv --backup=t -v $1 $data\ $godzina.$roz
			elif [ $save == 1 ]; then
				cp --backup=t -vp $1 $data\ $godzina.$roz
			else
				echo "Sth went really wrong."
			fi 
		fi
	else
		echo "Probably specyfied file ($1) is not image"
	fi
	# Przywróć stary IFS
	IFS=$SAVEIFS
}

function help(){
	echo -e "Usage:\n\tnameIT IMG1.jpg IMG2.jpg\nHint:\n\tnameIT *.[Jj][pP][gG]"
}

case $1 in
	help|-h)
		help
	;;
	"")
		help
	;;
	*)
		echo "Keep original files? (Y/N) - default Y"
		read a
		case $a in
			Y|y)
				save=1
			;;
			N|n)
				save=0
			;;
			*)
				save=1
			;;
		esac
		# Połącz argumenty z \ w całość
		for args in "$@"
		do
			changeName "$args" 
		done
	;;
esac

